nameOverride: zimagi

labels: {}
annotations: {}

postgresql:
  enabled: true
  auth:
    existingSecret: zimagi-db # keys: postgres-password, replication-password, password
    database: zimagi
    username: zimagi
  primary:
    persistence:
      enabled: true
      size: 10Gi

redis:
  enabled: true
  auth:
    existingSecret: zimagi-db
    existingSecretPasswordKey: redis-password
  master:
    persistence:
      enabled: true
      size: 5Gi

image:
  pullSecrets: []
  pullPolicy: IfNotPresent
  repository: registry.hub.docker.com
  image: zimagi/zimagi
  tag: 0.11.16

pvc:
  claims:
    lib:
      storageClass: nfs
      accessMode: ReadWriteMany
      size: 10Gi
  mounts: {}

deployment:
  replicaCount: 1
  updateStrategy:
    type: RollingUpdate

  priorityClassName: ""
  affinity: {}
  podAffinityPreset: ""
  podAntiAffinityPreset: soft
  nodeAffinityPreset:
    type: ""
    key: ""
    values: []

  nodeSelector: {}
  tolerations: []
  resources:
    requests:
      cpu: "100m"
      memory: "100Mi"

  env:
    ZIMAGI_POSTGRES_HOST: '{{ include "zimagi.postgresql.fullname" . }}'
    ZIMAGI_POSTGRES_PORT: 5432
    ZIMAGI_POSTGRES_DB: "{{ .Values.postgresql.auth.database }}"
    ZIMAGI_POSTGRES_USER: "{{ .Values.postgresql.auth.username }}"
    ZIMAGI_REDIS_HOST: '{{ include "zimagi.redisMaster.fullname" . }}'
    ZIMAGI_REDIS_PORT: 6379

  config:
    - global
  secrets:
    - global

  protocol: HTTP
  port: 5000

  livenessProbe:
    endpoint: "/status"
    failureThreshold: 6
    initialDelaySeconds: 10
    periodSeconds: 5
    successThreshold: 1
    timeoutSeconds: 5

  readinessProbe:
    endpoint: "/status"
    failureThreshold: 3
    initialDelaySeconds: 10
    periodSeconds: 5
    successThreshold: 3
    timeoutSeconds: 5

autoscaling:
  minReplicas: 1
  maxReplicas: 4
  avgCpuUtilization: 70

service:
  type: ClusterIP
  protocol: http
  port: 80

ingress:
  className: ''
  hosts: []
  tls: []

services:
  command-api:
    image:
      entrypoint: "zimagi-command"
    pvc:
      mounts:
        "/usr/local/lib/zimagi": lib
    deployment:
      config:
        - global
        - command-api
    autoscaling:
      enabled: false
    service:
      enabled: true
    ingress:
      enabled: false
      # hosts:
      #   - host: "command-api.${domain}"
      # tls:
      #   - secretName: origin-cert

  data-api:
    image:
      entrypoint: "zimagi-data"
    pvc:
      mounts:
        "/usr/local/lib/zimagi": lib
    deployment:
      config:
        - global
        - data-api
    autoscaling:
      enabled: false
    service:
      enabled: true
    ingress:
      enabled: false
      # hosts:
      #   - host: "data-api.${domain}"
      # tls:
      #   - secretName: origin-cert

  scheduler:
    image:
      entrypoint: "zimagi-scheduler"
    pvc:
      mounts:
        "/usr/local/lib/zimagi": lib
    deployment:
      config:
        - global
        - scheduler

  worker:
    image:
      entrypoint: "zimagi-worker"
    pvc:
      mounts:
        "/usr/local/lib/zimagi": lib
    deployment:
      config:
        - global
        - worker
    autoscaling:
      enabled: false

  tasks:
    image:
      entrypoint: "celery-flower"
    deployment:
      config:
        - global
        - flower
      resources:
        requests:
          cpu: "20m"
          memory: "50Mi"
    autoscaling:
      enabled: false
    service:
      enabled: true
    ingress:
      enabled: false
      # hosts:
      #   - host: "tasks.${domain}"
      # tls:
      #   - secretName: origin-cert
